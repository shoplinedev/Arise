!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.globalSLM=t():e.globalSLM=t()}(self,(()=>(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t,n,r,o={};e.r(o),function(e){e.Country="country",e.Province="province",e.City="city",e.District="district",e.Name="name",e.FirstName="firstName",e.LastName="lastName",e.Mobile="mobile",e.Postcode="postcode",e.Company="company",e.Address="address",e.Address2="address2"}(t||(t={})),function(e){e[e.NAME=1]="NAME",e[e.FLName=2]="FLName"}(n||(n={})),function(e){e[e.Select=1]="Select",e[e.Input=2]="Input"}(r||(r={}));const i=[t.Country,t.Province,t.City,t.District,t.Name,t.FirstName,t.LastName,t.Mobile,t.Postcode,t.Address,t.Address2,t.Company],a=Symbol("@ts-pattern/matcher"),l="@ts-pattern/anonymous-select-key",d=e=>Boolean(e&&"object"==typeof e),s=e=>e&&!!e[a],u=(e,t,n)=>{if(d(e)){if(s(e)){const r=e[a](),{matched:o,selections:i={}}=r.match(t);return o&&Object.keys(i).forEach((e=>n(e,i[e]))),o}if(!d(t))return!1;if(Array.isArray(e))return!!Array.isArray(t)&&e.length===t.length&&e.every(((e,r)=>u(e,t[r],n)));if(e instanceof Map)return t instanceof Map&&Array.from(e.keys()).every((r=>u(e.get(r),t.get(r),n)));if(e instanceof Set){if(!(t instanceof Set))return!1;if(0===e.size)return 0===t.size;if(1===e.size){const[r]=Array.from(e.values());return s(r)?Array.from(t.values()).every((e=>u(r,e,n))):t.has(r)}return Array.from(e.values()).every((e=>t.has(e)))}return Object.keys(e).every((r=>{const o=e[r];return(r in t||s(i=o)&&"optional"===i[a]().matcherType)&&u(o,t[r],n);var i}))}return Object.is(t,e)},c=e=>{var t,n,r;return d(e)?s(e)?null!=(t=null==(n=(r=e[a]()).getSelectionKeys)?void 0:n.call(r))?t:[]:Array.isArray(e)?f(e,c):f(Object.values(e),c):[]},f=(e,t)=>e.reduce(((e,n)=>e.concat(t(n))),[]);function p(e){return{[a]:()=>({match:t=>{let n={};const r=(e,t)=>{n[e]=t};return void 0===t?(c(e).forEach((e=>r(e,void 0))),{matched:!0,selections:n}):{matched:u(e,t,r),selections:n}},getSelectionKeys:()=>c(e),matcherType:"optional"})}}function y(e){return{[a]:()=>({match:t=>{if(!Array.isArray(t))return{matched:!1};let n={};const r=(e,t)=>{n[e]=(n[e]||[]).concat([t])};return{matched:t.every((t=>u(e,t,r))),selections:n}},getSelectionKeys:()=>c(e)})}}function h(...e){return{[a]:()=>({match:t=>{let n={};const r=(e,t)=>{n[e]=t};return{matched:e.every((e=>u(e,t,r))),selections:n}},getSelectionKeys:()=>f(e,c),matcherType:"and"})}}function m(...e){return{[a]:()=>({match:t=>{let n={};const r=(e,t)=>{n[e]=t};return f(e,c).forEach((e=>r(e,void 0))),{matched:e.some((e=>u(e,t,r))),selections:n}},getSelectionKeys:()=>f(e,c),matcherType:"or"})}}function v(e){return{[a]:()=>({match:t=>({matched:!u(e,t,(()=>{}))}),getSelectionKeys:()=>[],matcherType:"not"})}}function b(e){return{[a]:()=>({match:t=>({matched:Boolean(e(t))})})}}function g(...e){const t="string"==typeof e[0]?e[0]:void 0,n=2===e.length?e[1]:"string"==typeof e[0]?void 0:e[0];return{[a]:()=>({match:e=>{let r={[null!=t?t:l]:e};return{matched:void 0===n||u(n,e,((e,t)=>{r[e]=t})),selections:r}},getSelectionKeys:()=>[null!=t?t:l].concat(void 0===n?[]:c(n))})}}const w=b((function(e){return!0})),T=w,O=b((function(e){return"string"==typeof e})),A=b((function(e){return"number"==typeof e})),M=b((function(e){return"boolean"==typeof e})),C=b((function(e){return"bigint"==typeof e})),N=b((function(e){return"symbol"==typeof e})),L=b((function(e){return null==e}));var j={__proto__:null,optional:p,array:y,intersection:h,union:m,not:v,when:b,select:g,any:w,_:T,string:O,number:A,boolean:M,bigint:C,symbol:N,nullish:L,instanceOf:function(e){return b(function(e){return t=>t instanceof e}(e))},typed:function(){return{array:y,optional:p,intersection:h,union:m,not:v,select:g,when:b}}};const F=e=>S(e,[]),S=(e,t)=>{const n=()=>{const n=t.find((({test:t})=>t(e)));if(!n){let t;try{t=JSON.stringify(e)}catch(n){t=e}throw new Error(`Pattern matching error: no pattern matches value ${t}`)}return n.handler(n.select(e),e)};return{with(...n){const r=n[n.length-1],o=[],i=[];3===n.length&&"function"==typeof n[1]?(o.push(n[0]),i.push(n[1])):o.push(...n.slice(0,n.length-1));let a={};return S(e,t.concat([{test:e=>Boolean(o.some((t=>u(t,e,((e,t)=>{a[e]=t}))))&&i.every((t=>t(e)))),handler:r,select:e=>Object.keys(a).length?l in a?a[l]:a:e}]))},when:(n,r)=>S(e,t.concat([{test:n,handler:r,select:e=>e}])),otherwise:n=>S(e,t.concat([{test:()=>!0,handler:n,select:e=>e}])).run(),exhaustive:()=>n(),run:n}},I=[t.Country,t.Province,t.City,t.District];function _(e){return I.indexOf(e)>=0}function P(e){return`${e}Code`}function E(e){for(let t=I.length-1;t>=0;--t)if(I[t]===e)return I[t-1]}function D(e){for(let t=0;t<I.length;++t)if(I[t]===e)return I[t+1]}function B(e,t){if(e===t)return 1;let n=I.length-1;for(;n>=0;){if(I[n]===e)break;n-=1}if(n<0)return 0;let r=0;for(;r<I.length;){if(I[r]===t)break;r+=1}return r>=I.length||r>n?0:n-r+1}function k(e){return e?I.slice(1):[...I]}function K(e){return F(e).with(t.Country,(()=>({propKey:t.Country,interactionType:r.Select,priority:7,displayOrder:7,display:!0,required:!0,title:"Country/region",placeholder:"Country/region",remindCopywriter:"Select a country / region"}))).with(t.Province,(()=>({propKey:t.Province,interactionType:r.Select,priority:8,displayOrder:8,display:!0,required:!0,title:"State/province",placeholder:"State/province",remindCopywriter:"Select a state / province"}))).with(t.City,(()=>({propKey:t.City,interactionType:r.Input,priority:6,displayOrder:6,display:!0,required:!0,title:"City",placeholder:"City",remindCopywriter:"Enter a city"}))).with(t.District,(()=>({propKey:t.District,interactionType:r.Input,priority:9,displayOrder:9,display:!1,required:!1,title:"District",placeholder:"District",remindCopywriter:"Enter a district"}))).with(t.Address,(()=>({propKey:t.Address,interactionType:r.Input,priority:4,displayOrder:4,display:!0,required:!0,title:"Address",placeholder:"Address",remindCopywriter:"Enter an address"}))).with(t.Address2,(()=>({propKey:t.Address2,interactionType:r.Input,priority:5,displayOrder:5,display:!0,required:!1,title:"Address2",placeholder:"Apartment, suite, etc. (optional)",remindCopywriter:""}))).with(t.Name,(()=>({propKey:t.Name,interactionType:r.Input,priority:1,displayOrder:1,display:!1,required:!1,title:"Name",placeholder:"Name",remindCopywriter:"Enter a name"}))).with(t.FirstName,(()=>({propKey:t.FirstName,interactionType:r.Input,priority:2,displayOrder:2,display:!0,required:!0,title:"First name",placeholder:"First name",remindCopywriter:"Enter a first name"}))).with(t.LastName,(()=>({propKey:t.LastName,interactionType:r.Input,priority:3,displayOrder:3,display:!0,required:!0,title:"Last name",placeholder:"Last name",remindCopywriter:"Enter a last name"}))).with(t.Mobile,(()=>({propKey:t.Mobile,interactionType:r.Input,priority:11,displayOrder:11,display:!0,required:!0,title:"Phone",placeholder:"Phone",remindCopywriter:"Enter a valid phone number"}))).with(t.Postcode,(()=>({propKey:t.Postcode,interactionType:r.Input,priority:9,displayOrder:9,display:!0,required:!0,title:"ZIP code",placeholder:"ZIP code",remindCopywriter:"ZIP code"}))).with(t.Company,(()=>({propKey:t.Company,interactionType:r.Input,priority:12,displayOrder:12,display:!1,required:!1,title:"Company",placeholder:"Company",remindCopywriter:"Company"}))).otherwise((e=>({propKey:e,interactionType:r.Input,priority:-1,displayOrder:-1,display:!1,required:!1,title:e,placeholder:e,remindCopywriter:""})))}function U(e){return!1!==e.display}function V(e){return e.interactionType===r.Select}function G(e){return Object.assign(Object.assign({},e),{interactionType:r.Input})}function x(e){return Object.assign(Object.assign({},e),{interactionType:r.Select})}function q(){return{country:"DEFAULT",nameType:n.FLName,props:i.map((e=>K(e)))}}function R(e){let{country:r,nameType:o,props:i}=e,a=100;const l=i.reduce(((e,t)=>(e[t.propKey]=t,e)),{}),d={forceFullNameMode:()=>(o=n.NAME,l[t.Name].display=!0,l[t.LastName].display=!1,l[t.FirstName].display=!1,d),forceFLNameMode:()=>(o=n.FLName,l[t.Name].display=!1,l[t.LastName].display=!0,l[t.FirstName].display=!0,d),hasField:e=>l.hasOwnProperty(e),setField(e){const{propKey:t}=e;return l.hasOwnProperty(t)||(l[t]=Object.assign(Object.assign({},e),{priority:a+=1})),d},build:()=>({country:r,nameType:o,props:Object.keys(l).map((e=>l[e])).sort(((e,t)=>e.priority-t.priority))})};return d}var z,W;function $(e){return{success:!0,code:z.SUCCESS,data:e}}function Z(e,t,n){return{success:!1,code:e,msg:n}}function H(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function J(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{d(r.next(e))}catch(e){i(e)}}function l(e){try{d(r.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}d((r=r.apply(e,t||[])).next())}))}function Y(e,t){return F(e).with({type:"fieldUpdatedBlob",payload:j.select()},(e=>e.candidates[0])).with({type:"fieldsUpdatedBlob",payload:j.select()},(e=>e[t][0])).with({type:"addressInfoReplacedBlob",payload:j.select()},(e=>e[t]||"")).with({type:"addressInfoUpdatedBlob",payload:j.select()},(e=>e[t]||"")).otherwise((()=>""))}function Q(e,t,n){if(n<1)return;e(t);const r=D(t);r&&Q(e,r,n-1)}function X(e,t,n){function r(e,t,n,o){if(!(o<1)&&Array.isArray(e)&&!(e.length<=0))if(1!==o)for(let i of e)r(i.subNodes||[],t,n,o-1);else for(let r of e){if(!1===n(t,r))break}}const o={};return Q((n=>{o[n]={traverse(o){!function(n,o){const i=B(n,t);r(e,n,((e,t)=>{o(e,t)}),i)}(n,o)},bailTraverse(o){!function(n,o){const i=B(n,t);r(e,n,o,i)}(n,o)}}}),t,n),o}function ee(){return{traverse(e){},bailTraverse(e){}}}function te(e,t){if(null==e)return;let n;return e.bailTraverse(((e,r)=>{if(r)for(let e=0;e<t.length;++e){const o=t[e];if(r.code===o)return n=r,!1}})),n||e.bailTraverse(((e,r)=>{if(r)for(let e=0;e<t.length;++e){const o=t[e];if(o&&ne(r.gCode||r.gcode||"",o.trim()))return n=r,!1}})),n||e.bailTraverse(((e,r)=>{if(r)for(let e=0;e<t.length;++e){const o=t[e];if(o&&re(r.name||"",o.trim()))return n=r,!1}})),n}function ne(e,t){return"string"==typeof e&&"string"==typeof t&&e.toLowerCase()===t.toLowerCase()}function re(e,t){return"string"==typeof e&&"string"==typeof t&&e.toLowerCase().indexOf(t.toLowerCase())>=0}!function(e){e.SUCCESS="SUCCESS",e.FA_INVALID_PARAMS="FA_INVALID_PARAMS",e.FA_DOMAIN__INVALID_COUNTRY="FA_DOMAIN__INVALID_COUNTRY",e.FA_DOMAIN__INVALID_TEMPLATE="FA_DOMAIN__INVALID_TEMPLATE"}(z||(z={})),function(e){e[e.Nil=0]="Nil",e[e.Name=1]="Name",e[e.Logistics=2]="Logistics"}(W||(W={}));const oe={[t.FirstName]:W.Name,[t.LastName]:W.Name,[t.Name]:W.Name,[t.Country]:W.Logistics,[t.Province]:W.Logistics,[t.City]:W.Logistics,[t.District]:W.Logistics,[t.Postcode]:W.Logistics};function ie(e){const t={},n=[],r=[];return(e||[]).forEach(((e,t)=>{const o=Math.floor(t/3),i=Math.floor(t/3);null==n[o]?n[o]=1:n[o]+=1,null==r[i]?r[i]=1:r[i]+=1})),(e||[]).forEach(((e,o)=>{const i=Math.floor(o/3),a=Math.floor(o/3);null==t[e]&&(t[e]={xs:24,md:24/(n[i]||1),xl:24/(r[a]||1)})})),t}function ae(e,t){return{get country(){return e},get template(){return t},takeGroupModel:()=>le(function(e){const{props:t}=e,n=t.slice(0).sort(((e,t)=>e.priority-t.priority)),r=[];return n.reduce(((e,t,o)=>{const i=e[e.length-1],a=o===n.length-1;return i?e.length<3&&oe[i]&&oe[i]===oe[t.propKey]?(e.push(t.propKey),a&&r.push(e),e):(r.push(e),a&&r.push([t.propKey]),[t.propKey]):(a&&r.push([t.propKey]),[t.propKey])}),[]),r}(t)),takeGroupModelWithStringifyTemplate:e=>le(function*(e){let t=[],n={begin:-1,end:-1};const r=(n,r)=>{const o=0,i=e.length-1;if(n<o||r<o)return;if(n>i||r>i)return;if(n>=r)return;const a=e.slice(n+1,r);a.length<=0||t.push(a)};for(let o=0;o<e.length;++o){switch(e[o]){case"{":n={begin:o,end:-1};break;case"}":n.end=o,r(n.begin,n.end);break;case"_":yield Array.from(t),t=[]}}t.length>0&&(yield Array.from(t));return}(e))}}function le(e){let n=[];for(let r of e)n.push({type:"Group",elements:r.map((e=>("address1"===e&&(e=t.Address),{type:"Element",fieldName:e})))});return{prependGroup(...e){const t=new Set(e);n=ue(n,(e=>!t.has(e))),n.unshift(de(e))},insertGroupBefore(e,...t){const r=new Set(t);n=ue(n,(e=>!r.has(e)));let o=-1;n.forEach(((t,n)=>{t&&"Group"===t.type&&t.elements.forEach((t=>{"Element"===t.type&&t.fieldName===e&&(o=n)}))})),(o<0||o>=n.length)&&(o=n.length),n=[...n.slice(0,o),de(t),...n.slice(o)]},build(){const e=[];return n.forEach((t=>{"Group"===t.type&&e.push(t.elements.map((e=>e.fieldName)))})),e}}}function de(e){return{type:"Group",elements:e.map(se)}}function se(e){return{type:"Element",fieldName:e}}function ue(e,t){const n=[];return e.forEach((e=>{if(e&&"Group"===e.type){const r=function(e,t){if(!e)return null;const n=[];return e.elements.forEach((e=>{e&&t(e.fieldName)&&n.push(e)})),n.length<=0?null:{type:"Group",elements:n}}(e,t);r&&n.push(r)}})),n}function ce(e,t){return e.levelValueMap[t]}function fe(e,t){return e.infoFieldSet.has(t)?e.infoFieldValueMap[t]:void 0}function pe(e,r){switch(r){case t.FirstName:case t.LastName:return e.addressTemplateNameMode===n.FLName;case t.Name:return e.addressTemplateNameMode===n.NAME;default:return!0}}var ye={initDomainState:function(e){let t={addressTemplate:e.addressTemplate,addressTemplateNameMode:e.addressTemplate.nameType,fieldLayoutGroup:e.fieldLayoutGroup,fieldTemplateMap:{},levelValueMap:I.reduce(((e,t)=>(e[t]={code:void 0,name:void 0},e)),{}),levelAddressBookTraverserMap:I.reduce(((e,t)=>(e[t]=ee(),e)),{}),infoFieldSet:new Set,infoFieldValueMap:{}};return e.addressTemplate.props.forEach((e=>{F(e).with({propKey:j.union(...I)},(e=>{t.fieldTemplateMap[e.propKey]=e})).otherwise((e=>{t.infoFieldSet.add(e.propKey),t.fieldTemplateMap[e.propKey]=e}))})),t},withLevelField:function(e,t,n){let[r,o,i]=n([e.fieldTemplateMap[t],e.levelValueMap[t],e.levelAddressBookTraverserMap[t]]);if(e=Object.assign({},e),V(r)&&i[t]){e.levelAddressBookTraverserMap=Object.assign(Object.assign({},e.levelAddressBookTraverserMap),i);te(i[t],[o.code,o.name])||(o={code:void 0,name:void 0})}else r=G(r),o=U(r)?Object.assign(Object.assign({},{code:void 0,name:void 0}),{name:o.name}):Object.assign({},{code:void 0,name:void 0}),function(e,t){let n=!1;for(let r=0;r<I.length;++r)I[r]===t&&(n=!0),n&&e(I[r])}((t=>{var n;e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:G(null===(n=e.fieldTemplateMap)||void 0===n?void 0:n[t])})}),t);return e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:r}),e.levelValueMap=Object.assign(Object.assign({},e.levelValueMap),{[t]:o}),e},withInfoField:function(e,t,n){let[r,o]=n([e.fieldTemplateMap[t]||K(t),e.infoFieldValueMap[t]]);return(e=Object.assign({},e)).infoFieldSet.has(t)||(e.infoFieldSet=new Set(e.infoFieldSet),e.infoFieldSet.add(t)),e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:r}),e.infoFieldValueMap=Object.assign(Object.assign({},e.infoFieldValueMap),{[t]:U(r)?o:null}),e},isNameModeMatched:pe,getLevelInfo:ce,getCountryCode:function(e){return ce(e,t.Country).code},getInfoFieldValue:fe,getAddressInfo:function(e){const n={};for(let r of e.infoFieldSet){const o=fe(e,r)||"";switch(r){case t.Name:pe(e,t.Name)&&(n[t.Name]=o);break;case t.LastName:case t.FirstName:pe(e,r)&&(n[r]=o);break;default:n[r]=o}}return k().forEach((t=>{const r=ce(e,t);n[P(t)]=r.code||"",n[t]=r.name||""})),n},getFieldTemplateLayout:function(e){const n=new Set;let r={};for(let o of e.fieldLayoutGroup){const i=[];o.forEach((r=>{e.fieldTemplateMap[r]&&(pe(e,r)||r!==t.LastName||(r=t.Name),U(e.fieldTemplateMap[r])&&pe(e,r)&&(n.has(r)&&n.delete(r),n.add(r),i.push(r)))})),r=Object.assign(Object.assign({},r),ie(i))}const o=[];return[...e.infoFieldSet,...k()].forEach((e=>{n.has(e)||o.push(e)})),{get fieldTemplateLayout(){return r},get fieldTemplateSequence(){return[...n,...o.sort(((t,n)=>e.fieldTemplateMap[t].priority-e.fieldTemplateMap[n].priority))]}}}};function he(e){function n(t,n,r,o){return J(this,void 0,void 0,(function*(){const i=n.fieldTemplateMap[r],a=o.diffAddressFieldInfo(r);if(!V(i))return ye.withLevelField(n,r,(([e])=>[G(e),F(a).with({type:"Changed",payload:j.select()},(e=>Object.assign(Object.assign({},{code:void 0,name:void 0}),{name:Y(e,r)}))).otherwise((()=>V(t.fieldTemplateMap[r])?{code:void 0,name:void 0}:Object.assign(Object.assign({},t.levelValueMap[r]),{code:void 0}))),{}]));if(!U(i))return n;const l=function(e,t){let n=1,r=E(t);for(;null!=r;){let t=e.fieldTemplateMap[r];if(!V(t))return null;if(U(t))return{fieldName:r,addressCode:e.levelValueMap[r].code||"",depth:n};n+=1,r=E(r)}return null}(n,r);if(null==l)return ye.withLevelField(n,r,(([e])=>[G(e),F(a).with({type:"Changed",payload:j.select()},(e=>Object.assign(Object.assign({},{code:void 0,name:void 0}),{name:Y(e,r)}))).otherwise((()=>Object.assign(Object.assign({},t.levelValueMap[r]),{code:void 0}))),{}]));const d=ye.getCountryCode(n);if(!d||!l.addressCode)return ye.withLevelField(n,r,(([e])=>[x(e),{code:void 0,name:void 0},{[r]:ee()}]));const s=yield e.getAddressBook(d,l.fieldName,l.addressCode,l.depth);if(!s.success||s.data.length<=0)return ye.withLevelField(n,r,(([e])=>[G(e),F(a).with({type:"Changed",payload:j.select()},(e=>Object.assign(Object.assign({},{code:void 0,name:void 0}),{name:Y(e,r)}))).otherwise((()=>Object.assign(Object.assign({},t.levelValueMap[r]),{code:void 0}))),{}]));const u=X(s.data,D(l.fieldName),l.depth);return ye.withLevelField(n,r,(([e])=>[x(e),F(a).with({type:"Changed",payload:j.select()},(e=>{const t=te(u[r],function(e,t){return F(e).with({type:"fieldUpdatedBlob",payload:j.select()},(e=>e.candidates)).with({type:"fieldsUpdatedBlob",payload:j.select()},(e=>e[t]||[])).with({type:j.union("addressInfoUpdatedBlob","addressInfoReplacedBlob"),payload:j.select()},(e=>[_(t)&&e[P(t)]||"",e[t]||""])).otherwise((()=>[]))}(e,r));return t?{code:t.code,name:t.name}:{code:void 0,name:void 0}})).otherwise((()=>{const e=ye.getLevelInfo(t,r),n=te(u[r],[e.code,e.name]);return n?{code:n.code,name:n.name}:{code:void 0,name:void 0}})),u]))}))}function r(e,t,n,r){return J(this,void 0,void 0,(function*(){if(!function(e,t,n,r){const o=t.fieldTemplateMap[n];if(!V(o))return!1;if(U(o))return!1;const i=D(n);return!!i&&(V(t.fieldTemplateMap[i])&&!!ye.getLevelInfo(t,i).code)}(0,t,n))return t;const e=D(n);if(!e)return t;const r=ye.getLevelInfo(t,e),o=te(t.levelAddressBookTraverserMap[e],[r.code]);if(!o)return t;const i=o.parentCode||o.pCode||o.pcode;if(!i)return t;const a=te(t.levelAddressBookTraverserMap[n],[i]);return a?ye.withLevelField(t,n,(([e,t,r])=>[e,{code:a.code,name:a.name},{[n]:r}])):t}))}function o(e,n,r){return J(this,void 0,void 0,(function*(){if(!function(e,n){if(ye.getInfoFieldValue(e,t.Postcode))return!1;const r=n.diffAddressFieldInfo(t.Postcode);return F(r).with({type:"Changed",payload:j.select()},(e=>F(e).with({type:j.union("fieldUpdatedBlob","fieldsUpdatedBlob")},(e=>!1)).otherwise((()=>!0)))).otherwise((()=>!0))}(n,r))return n;let e=t.District;do{if(null!=e&&V(n.fieldTemplateMap[e])){const r=te(n.levelAddressBookTraverserMap[e],[ye.getLevelInfo(n,e).code]);if(r)return"string"==typeof r.zipCode&&r.zipCode?n.infoFieldValueMap[t.Postcode]=r.zipCode:Array.isArray(r.zipCode)&&r.zipCode[0]&&(n.infoFieldValueMap[t.Postcode]=r.zipCode[0]),n}e=E(e)}while(e);return n}))}function i(e,t,n,r,o){return J(this,void 0,void 0,(function*(){const i=r.diffAddressFieldInfo(n);return ye.withInfoField(t,n,(([t,r])=>{if("function"==typeof(null==o?void 0:o.fieldTemplateDecorator)){const e=o.fieldTemplateDecorator(n,t);null!=e&&(t=Object.assign(Object.assign({},t),{display:e.display}))}return[t,F(i).with({type:"Changed",payload:j.select()},(e=>Y(e,n))).otherwise((()=>ye.getInfoFieldValue(e,n)))]}))}))}function a(t,n){return J(this,void 0,void 0,(function*(){let r=q();const o=yield e.getAddressTemplate(t||"DEFAULT");if(o.success&&(r=o.data),"function"==typeof(null==n?void 0:n.addressTemplateDecorator)){const e=R(r);n.addressTemplateDecorator(e),r=e.build()}return{addressTemplate:r,fieldLayoutGroup:l(t,r,n)}}))}function l(e,t,n){let r,o=ae(e,t);return"function"==typeof(null==n?void 0:n.fieldLayoutGroupDecorator)&&(r=n.fieldLayoutGroupDecorator(o)),r||(r=o.takeGroupModel()),r.build()}return{reduce(l,d,s){return J(this,void 0,void 0,(function*(){if(s.isClean())return $(l);const u=yield e.getCountryList();let c;if(!u.success||u.data.length<=0){const e=yield a("DEFAULT",d);c=ye.initDomainState({addressTemplate:e.addressTemplate,fieldLayoutGroup:e.fieldLayoutGroup}),c=ye.withLevelField(c,t.Country,(([e])=>[e,{code:void 0,name:void 0},X([],t.Country,1)]))}else{const e=X(u.data.map((e=>({name:e.name,code:e.code,alias:"",pCode:"",gCode:e.code,zipCode:[]}))),t.Country,1),n=s.diffAddressFieldInfo(t.Country);if("Changed"===n.type){let r=F(n.payload).with({type:"fieldUpdatedBlob",payload:j.select()},(e=>e.candidates[0])).with({type:"fieldsUpdatedBlob",payload:j.select()},(e=>e[t.Country][0])).with({type:"addressInfoReplacedBlob",payload:j.select()},(e=>e.countryCode||"")).with({type:"addressInfoUpdatedBlob",payload:j.select()},(e=>e.countryCode||"")).otherwise((()=>""));const o=r?u.data.find((e=>e.code===r)):null;if(null==o){const n=yield a("DEFAULT",d);c=ye.initDomainState({addressTemplate:n.addressTemplate,fieldLayoutGroup:n.fieldLayoutGroup}),c=ye.withLevelField(c,t.Country,(([t])=>[t,{code:void 0,name:void 0},e]))}else{const n=yield a(o.code,d);c=ye.initDomainState({addressTemplate:n.addressTemplate,fieldLayoutGroup:n.fieldLayoutGroup}),c=ye.withLevelField(c,t.Country,(([t])=>[t,o,e]))}}else{const n=yield a(ye.getCountryCode(l),d);c=ye.initDomainState({addressTemplate:n.addressTemplate,fieldLayoutGroup:n.fieldLayoutGroup}),c=ye.withLevelField(c,t.Country,(([n])=>[n,l.levelValueMap[t.Country],e]))}}for(const e of k(!0))c=yield n(l,c,e,s);for(const e of k(!0).reverse())c=yield r(0,c,e);for(let e of c.infoFieldSet)c=yield i(l,c,e,s,d);return c=yield o(0,c,s),$(c)}))}}}function me(e,t){const n=ye.getFieldTemplateLayout(e),r={get addressInfo(){return ye.getAddressInfo(e)},get addressTemplate(){return e.addressTemplate},get fieldTemplateMap(){return Object.assign({},e.fieldTemplateMap)},get fieldAddressBookTraverser(){return Object.assign({},e.levelAddressBookTraverserMap)},fieldTemplateLayout:n.fieldTemplateLayout,fieldTemplateSequence:n.fieldTemplateSequence,get fieldAddressBookMap(){return k().reduce(((t,n)=>{const r=e.levelAddressBookTraverserMap[n];return Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get(){const e=[];return r&&r.traverse(((t,n)=>{const r=H(n,["subNodes"]);e.push(r)})),e}}),t}),{})},traverseAddressLevelField(t){k().forEach((n=>t(n,e.fieldTemplateMap[n])))},traverseAddressInfoField(t){e.infoFieldSet.forEach((n=>t(n,e.fieldTemplateMap[n])))},traverseAddressField(e){r.traverseAddressLevelField(e),r.traverseAddressInfoField(e)},bailTraverseAddressLevelField(t,n){const r=k();for(let n=0;n<r.length;++n){const o=r[n],i=t(o,e.fieldTemplateMap[o]);if(void 0!==i)return i}return n}};return r}function ve(e){let t,n;return function(...r){if(t&&be(t,r)&&n)return n;t=r,n=void 0;const o=e.apply(this,r);return n=o,function(e){return!!e&&"object"==typeof e&&(e instanceof Promise||"function"==typeof e.then)}(o)&&function(e){return!!e&&"object"==typeof e&&(e instanceof Promise||"function"==typeof e.catch)}(o)&&o.catch((e=>{t===r&&n===o&&(t=void 0,n=void 0)})),o}}function be(e,t){if(e===t)return!0;if(null==e||null==t)return!1;const n=typeof e;if(n!==typeof t)return!1;if("function"===n)return!1;if(Array.isArray(e)&&Array.isArray(t)){const n=e.length,r=t.length;if(n!==r)return!1;let o=0;for(;o<n;++o){if(!be(e[o],t[o]))return!1}return o===r}return!1}function ge(e){const n=function(e){return{getAddressTemplate:ve((n=>J(this,void 0,void 0,(function*(){const r=yield e.getAddressTemplate(n).catch((e=>(console.error("failed to get getAddressTemplate",e),Z("FA_ADDRESS_UNKNOWN"))));return r.success?Object.assign(Object.assign({},r),{data:Object.assign(Object.assign({},r.data),{props:r.data.props.map((e=>"address1"===e.propKey?Object.assign(Object.assign({},e),{propKey:t.Address}):e))})}):r}))))}}(e.addressTemplateFetcher),r=function(e){const t={};function n(e,t,n){return`${e}__${t}__${n||1}`}function r(){return{getAddressBook:ve(((t,n,r,o)=>e.getAddressBook(t,n,r,o).catch((e=>(console.error("failed to get getAddressBook",e),Z("FA_ADDRESS_UNKNOWN"))))))}}function o(e,o,i,a){const l=n(e,o,a);return null==t[l]&&(t[l]=r()),t[l]}return{getAddressBook:(e,t,n,r)=>o(e,t,n,r).getAddressBook(e,t,n,r)}}(e.addressBookFetcher),o=function(e){const t=ve(e.getCountryList);return{getCountryList:()=>t().catch((e=>(console.error("failed to get getCountryList",e),Z("FA_ADDRESS_UNKNOWN"))))}}(e.countrySource);return{get port(){return Object.assign(Object.assign(Object.assign({},o),n),r)}}}const we="Defer",Te="Blocking";function Oe(e,t){const n={pending:!1,scheduled:!1},r=(o=()=>{n.pending=!1,i()},{tick(e){e().finally((()=>{o()}))}});var o;const i=()=>{!n.pending&&n.scheduled&&(n.scheduled=!1,n.pending=!0,r.tick(e))};return{tick(e){switch(e){case we:return n.scheduled=!0,void setTimeout((()=>{i()}),function(e){"number"!=typeof e&&(e=Number(e));(e!=e||e<0)&&(e=10);return e}(null==t?void 0:t.deferTimeout));case Te:return n.scheduled=!0,void i();default:return}}}}function Ae(e){const n=[],r=[],o=Oe((()=>J(this,void 0,void 0,(function*(){let t=n.slice(0);for(;t.length>0;)yield e(t),n.splice(0,t.length),t=n.slice(0);r.splice(0).forEach((e=>{"function"==typeof e&&e()}))}))),{deferTimeout:10});return{add(e){console.debug("add address blob stream",JSON.stringify(e,null,2)),n.push(e),F(function(e){return F(e).with({type:j.union("addressInfoReplacedBlob","addressInfoUpdatedBlob","fieldsUpdatedBlob")},(e=>Te)).with({type:"fieldUpdatedBlob",payload:j.select()},(e=>Reflect.has(e,t.Country)?Te:we)).otherwise((()=>we))}(e)).with(Te,(()=>o.tick(Te))).otherwise((()=>o.tick(we)))},exhaust:()=>n.length<=0?Promise.resolve():new Promise((e=>{r.push(e)}))}}function Me(e){var t,n,r;const o=R((null===(t=null==e?void 0:e.initState)||void 0===t?void 0:t.addressTemplate)||q());"function"==typeof(null===(n=null==e?void 0:e.initProps)||void 0===n?void 0:n.addressTemplateDecorator)&&e.initProps.addressTemplateDecorator(o);const i=o.build();let a,l=ae(i.country,i);"function"==typeof(null===(r=null==e?void 0:e.initProps)||void 0===r?void 0:r.fieldLayoutGroupDecorator)&&(a=null==e?void 0:e.initProps.fieldLayoutGroupDecorator(l)),null==a&&(a=l.takeGroupModel());let d=ye.initDomainState({addressTemplate:i,fieldLayoutGroup:a.build()}),s=e.initProps||{},u=me(d),c=ge(e.adapter);const f=function(){const e=new Set;return{next(t){e.forEach((e=>{"function"==typeof e&&e(t)}))},subscribe:t=>(e.add(t),{unsubscribe(){e.delete(t)}})}}();let p=he(c.port);const y=Ae((e=>J(this,void 0,void 0,(function*(){const t=function(e){const t=(n=e.reverse(),function(e){for(let t of n){const n=e(t);if(void 0!==n)return n}});var n;function r(e){return void 0!==e?{type:"Changed",payload:e}:{type:"Clean"}}return{isClean:()=>e.length<=0,diffDomainProps:()=>r(t((e=>F(e).with({type:"domainPropsUpdatedBlob"},(e=>e)).otherwise((()=>{}))))),diffAddressFieldInfo:e=>r(t((t=>F(t).with({type:"fieldUpdatedBlob",payload:{fieldName:e}},(e=>e)).with({type:"fieldsUpdatedBlob"},(({payload:t})=>null!=t[e]),(e=>e)).with({type:"addressInfoUpdatedBlob"},(({payload:t})=>_(e)&&null!=t[P(e)]||null!=t[e]),(e=>e)).with({type:"addressInfoReplacedBlob"},(e=>e)).otherwise((()=>{})))))}}(e);let n=s,r=t.diffDomainProps();"Changed"===r.type&&(n=r.payload.payload);const o=yield p.reduce(d,n,t);o.success?(d=o.data,u=me(o.data),f.next(u),s=n):f.next(u)})))),h={init(){var t;return y.add({type:"addressInfoReplacedBlob",payload:(null===(t=e.initState)||void 0===t?void 0:t.addressInfo)||{}}),h.exhaustModel()},getModel:()=>u,exhaustModel:()=>y.exhaust().then((()=>u)),observeModel:(e,t)=>(!0===t&&setTimeout((()=>{e(u)}),0),f.subscribe(e)),updateAdapter(e){h.exhaustModel().finally((()=>{c=ge(e),p=he(c.port),h.updateFieldsValue({})}))},updateProps(e){let t;t="function"==typeof e?e(s):e,y.add({type:"domainPropsUpdatedBlob",payload:t})},updateFieldValue(e,...t){y.add({type:"fieldUpdatedBlob",payload:{fieldName:e,candidates:t}})},updateFieldsValue(e){y.add({type:"fieldsUpdatedBlob",payload:Object.keys(e).reduce(((t,n)=>(t[n]=[e[n]],t)),{})})},updateFieldsValueWithCandidates(e){y.add({type:"fieldsUpdatedBlob",payload:Object.keys(e).reduce(((t,n)=>(t[n]=e[n],t)),{})})},updateAddressInfo(e){y.add({type:"addressInfoUpdatedBlob",payload:e})},clearAddressInfo(){y.add({type:"addressInfoReplacedBlob",payload:{}})},replaceAddressInfo(e){y.add({type:"addressInfoReplacedBlob",payload:e})}};return h}var Ce="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==e.g?e.g:"undefined"!=typeof self?self:{};function Ne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Le={},je={},Fe={},Se=Ce&&Ce.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{d(r.next(e))}catch(e){i(e)}}function l(e){try{d(r.throw(e))}catch(e){i(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}d((r=r.apply(e,t||[])).next())}))},Ie=Ce&&Ce.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};Object.defineProperty(Fe,"__esModule",{value:!0});var _e=new Promise((function(e){}));Fe.default={zombie:_e,resolvable:function(){var e,t=!1;return[new Promise((function(n){t?n():e=n})),function(){t=!0,"function"==typeof e&&e()}]},resolveAfterEventBubbled:function(e,t){return Se(this,void 0,void 0,(function(){return Ie(this,(function(n){return[2,new Promise((function(n){var r=function(o){e.removeEventListener(t,r),n(o)};e.addEventListener(t,r)}))]}))}))},resolveAfterSeconds:function(e){return Se(this,void 0,void 0,(function(){return Ie(this,(function(t){return e<=0?[2,Promise.resolve()]:[2,new Promise((function(t){setTimeout((function(){t()}),1e3*e)}))]}))}))},resolveAfterDuration:function(e){return Se(this,void 0,void 0,(function(){return Ie(this,(function(t){return e<=0?[2,Promise.resolve()]:[2,new Promise((function(t){setTimeout((function(){t()}),e)}))]}))}))}};var Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});var Ee=36e5,De=24*Ee,Be=function(){function e(e){this.v=e}return Object.defineProperty(e.prototype,"timestamp",{get:function(){return this.v},enumerable:!1,configurable:!0}),e.prototype.add=function(t){return new e(this.v+t)},e.prototype.sub=function(t){return new e(this.v-t)},e.prototype.duration=function(e){return this.v-e.timestamp},e}();function ke(e){return new Be(e)}function Ke(){return ke(Date.now())}Pe.default={time:ke,now:Ke,later:function(e){return Ke().add(e)},former:function(e){return Ke().sub(e)},Millisecond:1,Second:1e3,Minute:6e4,Hour:Ee,Day:De,Week:6048e5};var Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.default={errCanceled:"context done with cancellation",errTimeout:"context done with timeout",errDeadline:"context done with deadline",errNotNullableValuer:"valuer is not nullable"};var Ve=Ce&&Ce.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(je,"__esModule",{value:!0});var Ge=Ve(Fe),xe=Ve(Pe),qe=Ve(Ue);function Re(){return{deadline:function(){return null},done:function(){return Ge.default.zombie},err:function(){return null},value:function(e){return e?e.defaultGetter():null}}}function ze(e){return e||(e=$e),{deadline:function(){return e.deadline()},done:function(){return e.done()},err:function(){return e.err()},value:function(t){return e.value(t)}}}function We(e){var t=Ge.default.resolvable(),n=t[0],r=t[1],o=null;return[{deadline:function(){return e.deadline()},done:function(){return Promise.race([e.done().then((function(){return e.err()})),n.then((function(){return new Error(qe.default.errCanceled)}))]).then((function(e){o=e}))},err:function(){return o},value:function(t){return e.value(t)}},r]}je.default={background:function(){return ze($e)},todo:function(){return ze(Ze)},withValue:function(e,t,n){return function(e,t,n){return{deadline:function(){return e.deadline()},done:function(){return e.done()},err:function(){return e.err()},value:function(r){return t===r?n:e.value(r)}}}(e,t,n)},withCancel:function(e){return We(e)},withTimeout:function(e,t){return We(function(e,t){var n,r=xe.default.later(t),o=Ge.default.resolveAfterDuration(t);return{deadline:function(){return r},done:function(){return Promise.race([e.done().then((function(){return e.err()})),o.then((function(){return new Error(qe.default.errTimeout)}))]).then((function(e){n=e}))},err:function(){return n},value:function(t){return e.value(t)}}}(e,t))},withDeadline:function(e,t){return We(function(e,t){var n=null,r=Ge.default.resolveAfterDuration(t.duration(xe.default.now()));return{deadline:function(){return t},done:function(){return Promise.race([e.done().then((function(){return e.err()})),r.then((function(){return new Error(qe.default.errDeadline)}))]).then((function(e){n=e}))},err:function(){return n},value:function(t){return e.value(t)}}}(e,t))}};var $e=Re(),Ze=Re(),He={},Je=Ce&&Ce.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(He,"__esModule",{value:!0});var Ye=Je(Ue);function Qe(e){return Object.defineProperty({},"defaultGetter",{value:e,writable:!1,configurable:!1})}He.default={newValuer:function(e){return Qe(void 0===e?function(){throw new Error(Ye.default.errNotNullableValuer)}:function(){return e})},newValuerWithGetter:function(e){return"function"!=typeof e&&(e=function(){throw new Error(Ye.default.errNotNullableValuer)}),Qe(e)}},function(e){var t=Ce&&Ce.__assign||function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)},n=Ce&&Ce.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),r=Ce&&Ce.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},o=Ce&&Ce.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0});var i=o(je),a=o(Ue),l=o(He);r(je,e),r(He,e),e.default=t(t(t({},a.default),i.default),l.default)}(Le);var Xe=Ne(Le);return window["@sl/address-component"]={createHost:Me,distinctUntil:function(e,t,n,r){let[o,i]=Xe.withCancel(Xe.background()),[a,l]=Xe.withCancel(o);const d=function(e,t,n){let r;return e.observeModel((e=>{const n=(null==r?void 0:r.addressInfo)||{},o=e.addressInfo,i=new Set(Object.keys(n)),a=new Set(Object.keys(o)),l={};a.forEach((e=>{i.has(e)&&n[e]===o[e]||(l[e]=o[e]||null),i.delete(e)})),i.forEach((e=>{l[e]=null})),t([r,e,l]),r=e}),n)}(e,(([e,r])=>{if("function"==typeof t&&t(e,r)){const[e,t]=Xe.withCancel(o);l(),a.done().finally((()=>{n(e,r)})),a=e,l=t}}),r);return o.done().finally((()=>{d.unsubscribe()})),{unsubscribe(){i()}}},"/domain-model":{FieldNameEnum:t,FieldInteractionEnum:r}},o})()));