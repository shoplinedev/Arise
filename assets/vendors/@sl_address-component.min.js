!function(){"use strict";(I=E||(E={})).Country="country",I.Province="province",I.City="city",I.District="district",I.Name="name",I.FirstName="firstName",I.LastName="lastName",I.Mobile="mobile",I.Postcode="postcode",I.Company="company",I.Address="address",I.Address2="address2",(_=D||(D={}))[_.NAME=1]="NAME",_[_.FLName=2]="FLName",(P=k||(k={}))[P.Select=1]="Select",P[P.Input=2]="Input";let e=[E.Country,E.Province,E.City,E.District,E.Name,E.FirstName,E.LastName,E.Mobile,E.Postcode,E.Address,E.Address2,E.Company],t=Symbol("@ts-pattern/matcher"),r="@ts-pattern/anonymous-select-key",n=e=>!!(e&&"object"==typeof e),i=e=>e&&!!e[t],o=(e,r,a)=>{if(n(e)){if(i(e)){let n=e[t](),{matched:i,selections:o={}}=n.match(r);return i&&Object.keys(o).forEach(e=>a(e,o[e])),i}if(!n(r))return!1;if(Array.isArray(e))return!!Array.isArray(r)&&e.length===r.length&&e.every((e,t)=>o(e,r[t],a));if(e instanceof Map)return r instanceof Map&&Array.from(e.keys()).every(t=>o(e.get(t),r.get(t),a));if(e instanceof Set){if(!(r instanceof Set))return!1;if(0===e.size)return 0===r.size;if(1===e.size){let[t]=Array.from(e.values());return i(t)?Array.from(r.values()).every(e=>o(t,e,a)):r.has(t)}return Array.from(e.values()).every(e=>r.has(e))}return Object.keys(e).every(n=>{let l=e[n];return(n in r||i(l)&&"optional"===l[t]().matcherType)&&o(l,r[n],a)})}return Object.is(r,e)},a=e=>{var r,o,d;return n(e)?i(e)?null!=(r=null==(o=(d=e[t]()).getSelectionKeys)?void 0:o.call(d))?r:[]:Array.isArray(e)?l(e,a):l(Object.values(e),a):[]},l=(e,t)=>e.reduce((e,r)=>e.concat(t(r)),[]);function d(e){return{[t]:()=>({match:t=>{let r={},n=(e,t)=>{r[e]=t};return void 0===t?(a(e).forEach(e=>n(e,void 0)),{matched:!0,selections:r}):{matched:o(e,t,n),selections:r}},getSelectionKeys:()=>a(e),matcherType:"optional"})}}function u(e){return{[t]:()=>({match:t=>{if(!Array.isArray(t))return{matched:!1};let r={},n=(e,t)=>{r[e]=(r[e]||[]).concat([t])};return{matched:t.every(t=>o(e,t,n)),selections:r}},getSelectionKeys:()=>a(e)})}}function s(...e){return{[t]:()=>({match:t=>{let r={},n=(e,t)=>{r[e]=t};return{matched:e.every(e=>o(e,t,n)),selections:r}},getSelectionKeys:()=>l(e,a),matcherType:"and"})}}function c(...e){return{[t]:()=>({match:t=>{let r={},n=(e,t)=>{r[e]=t};return l(e,a).forEach(e=>n(e,void 0)),{matched:e.some(e=>o(e,t,n)),selections:r}},getSelectionKeys:()=>l(e,a),matcherType:"or"})}}function p(e){return{[t]:()=>({match:t=>({matched:!o(e,t,()=>{})}),getSelectionKeys:()=>[],matcherType:"not"})}}function f(e){return{[t]:()=>({match:t=>({matched:!!e(t)})})}}function y(...e){let n="string"==typeof e[0]?e[0]:void 0,i=2===e.length?e[1]:"string"==typeof e[0]?void 0:e[0];return{[t]:()=>({match:e=>{let t={[null!=n?n:r]:e};return{matched:void 0===i||o(i,e,(e,r)=>{t[e]=r}),selections:t}},getSelectionKeys:()=>[null!=n?n:r].concat(void 0===i?[]:a(i))})}}let h=f(function(e){return!0}),m=f(function(e){return"string"==typeof e}),v=f(function(e){return"number"==typeof e}),b=f(function(e){return"boolean"==typeof e}),g=f(function(e){return"bigint"==typeof e}),w=f(function(e){return"symbol"==typeof e}),T=f(function(e){return null==e});var O,A,C,M,N,F,L,j,S,I,_,P,E,D,k,B,K,U={__proto__:null,optional:d,array:u,intersection:s,union:c,not:p,when:f,select:y,any:h,_:h,string:m,number:v,boolean:b,bigint:g,symbol:w,nullish:T,instanceOf:function(e){return f(t=>t instanceof e)},typed:function(){return{array:u,optional:d,intersection:s,union:c,not:p,select:y,when:f}}};let V=e=>G(e,[]),G=(e,t)=>{let n=()=>{let r=t.find(({test:t})=>t(e));if(!r){let t;try{t=JSON.stringify(e)}catch(r){t=e}throw Error(`Pattern matching error: no pattern matches value ${t}`)}return r.handler(r.select(e),e)};return{with(...n){let i=n[n.length-1],a=[],l=[];3===n.length&&"function"==typeof n[1]?(a.push(n[0]),l.push(n[1])):a.push(...n.slice(0,n.length-1));let d={};return G(e,t.concat([{test:e=>!!(a.some(t=>o(t,e,(e,t)=>{d[e]=t}))&&l.every(t=>t(e))),handler:i,select:e=>Object.keys(d).length?r in d?d[r]:d:e}]))},when:(r,n)=>G(e,t.concat([{test:r,handler:n,select:e=>e}])),otherwise:r=>G(e,t.concat([{test:()=>!0,handler:r,select:e=>e}])).run(),exhaustive:()=>n(),run:n}},x=[E.Country,E.Province,E.City,E.District];function q(e){return x.indexOf(e)>=0}function R(e){return`${e}Code`}function z(e){for(let t=x.length-1;t>=0;--t)if(x[t]===e)return x[t-1]}function W(e){for(let t=0;t<x.length;++t)if(x[t]===e)return x[t+1]}function $(e,t){if(e===t)return 1;let r=x.length-1;for(;r>=0;){let t=x[r];if(t===e)break;r-=1}if(r<0)return 0;let n=0;for(;n<x.length;){let e=x[n];if(e===t)break;n+=1}return n>=x.length||n>r?0:r-n+1}function Z(e){return e?x.slice(1):[...x]}function H(){return{code:void 0,name:void 0}}function J(e){return V(e).with(E.Country,()=>({propKey:E.Country,interactionType:k.Select,priority:7,displayOrder:7,display:!0,required:!0,title:"Country/region",placeholder:"Country/region",remindCopywriter:"Select a country / region"})).with(E.Province,()=>({propKey:E.Province,interactionType:k.Select,priority:8,displayOrder:8,display:!0,required:!0,title:"State/province",placeholder:"State/province",remindCopywriter:"Select a state / province"})).with(E.City,()=>({propKey:E.City,interactionType:k.Input,priority:6,displayOrder:6,display:!0,required:!0,title:"City",placeholder:"City",remindCopywriter:"Enter a city"})).with(E.District,()=>({propKey:E.District,interactionType:k.Input,priority:9,displayOrder:9,display:!1,required:!1,title:"District",placeholder:"District",remindCopywriter:"Enter a district"})).with(E.Address,()=>({propKey:E.Address,interactionType:k.Input,priority:4,displayOrder:4,display:!0,required:!0,title:"Address",placeholder:"Address",remindCopywriter:"Enter an address"})).with(E.Address2,()=>({propKey:E.Address2,interactionType:k.Input,priority:5,displayOrder:5,display:!0,required:!1,title:"Address2",placeholder:"Apartment, suite, etc. (optional)",remindCopywriter:""})).with(E.Name,()=>({propKey:E.Name,interactionType:k.Input,priority:1,displayOrder:1,display:!1,required:!1,title:"Name",placeholder:"Name",remindCopywriter:"Enter a name"})).with(E.FirstName,()=>({propKey:E.FirstName,interactionType:k.Input,priority:2,displayOrder:2,display:!0,required:!0,title:"First name",placeholder:"First name",remindCopywriter:"Enter a first name"})).with(E.LastName,()=>({propKey:E.LastName,interactionType:k.Input,priority:3,displayOrder:3,display:!0,required:!0,title:"Last name",placeholder:"Last name",remindCopywriter:"Enter a last name"})).with(E.Mobile,()=>({propKey:E.Mobile,interactionType:k.Input,priority:11,displayOrder:11,display:!0,required:!0,title:"Phone",placeholder:"Phone",remindCopywriter:"Enter a valid phone number"})).with(E.Postcode,()=>({propKey:E.Postcode,interactionType:k.Input,priority:9,displayOrder:9,display:!0,required:!0,title:"ZIP code",placeholder:"ZIP code",remindCopywriter:"ZIP code"})).with(E.Company,()=>({propKey:E.Company,interactionType:k.Input,priority:12,displayOrder:12,display:!1,required:!1,title:"Company",placeholder:"Company",remindCopywriter:"Company"})).otherwise(e=>({propKey:e,interactionType:k.Input,priority:-1,displayOrder:-1,display:!1,required:!1,title:e,placeholder:e,remindCopywriter:""}))}function Y(e){return!1!==e.display}function Q(e){return e.interactionType===k.Select}function X(e){return Object.assign(Object.assign({},e),{interactionType:k.Input})}function ee(e){return Object.assign(Object.assign({},e),{interactionType:k.Select})}function et(){return{country:"DEFAULT",nameType:D.FLName,props:e.map(e=>J(e))}}function er(e){let{country:t,nameType:r,props:n}=e,i=100,o=n.reduce((e,t)=>(e[t.propKey]=t,e),{}),a={forceFullNameMode:()=>(r=D.NAME,o[E.Name].display=!0,o[E.LastName].display=!1,o[E.FirstName].display=!1,a),forceFLNameMode:()=>(r=D.FLName,o[E.Name].display=!1,o[E.LastName].display=!0,o[E.FirstName].display=!0,a),hasField:e=>o.hasOwnProperty(e),setField(e){let{propKey:t}=e;return o.hasOwnProperty(t)||(o[t]=Object.assign(Object.assign({},e),{priority:i+=1})),a},build:()=>({country:t,nameType:r,props:Object.keys(o).map(e=>o[e]).sort((e,t)=>e.priority-t.priority)})};return a}function en(e){return{success:!0,code:B.SUCCESS,data:e}}function ei(e,t,r){return{success:!1,code:e,msg:r}}function eo(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function l(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,l)}d((n=n.apply(e,t||[])).next())})}function ea(e,t){return V(e).with({type:"fieldUpdatedBlob",payload:U.select()},e=>e.candidates[0]).with({type:"fieldsUpdatedBlob",payload:U.select()},e=>e[t][0]).with({type:"addressInfoReplacedBlob",payload:U.select()},e=>e[t]||"").with({type:"addressInfoUpdatedBlob",payload:U.select()},e=>e[t]||"").otherwise(()=>"")}function el(e,t,r){function n(e,t,r,i){if(!(i<1)&&Array.isArray(e)&&!(e.length<=0)){if(1===i){for(let n of e){let e=r(t,n);if(!1===e)break}return}for(let o of e)n(o.subNodes||[],t,r,i-1)}}let i={};return!function e(t,r,n){if(n<1)return;t(r);let i=W(r);i&&e(t,i,n-1)}(r=>{i[r]={traverse(i){!function(r,i){let o=$(r,t);n(e,r,(e,t)=>{i(e,t)},o)}(r,i)},bailTraverse(i){!function(r,i){let o=$(r,t);n(e,r,i,o)}(r,i)}}},t,r),i}function ed(){return{traverse(e){},bailTraverse(e){}}}function eu(e,t){let r;if(null!=e)return e.bailTraverse((e,n)=>{if(n)for(let e=0;e<t.length;++e){let i=t[e];if(n.code===i)return r=n,!1}}),r||e.bailTraverse((e,n)=>{if(n)for(let e=0;e<t.length;++e){var i,o;let a=t[e];if(a&&(i=n.gCode||n.gcode||"",o=a.trim(),"string"==typeof i&&"string"==typeof o&&i.toLowerCase()===o.toLowerCase()))return r=n,!1}}),r||e.bailTraverse((e,n)=>{if(n)for(let e=0;e<t.length;++e){var i,o;let a=t[e];if(a&&(i=n.name||"",o=a.trim(),"string"==typeof i&&"string"==typeof o&&i.toLowerCase().indexOf(o.toLowerCase())>=0))return r=n,!1}}),r}(O=B||(B={})).SUCCESS="SUCCESS",O.FA_INVALID_PARAMS="FA_INVALID_PARAMS",O.FA_DOMAIN__INVALID_COUNTRY="FA_DOMAIN__INVALID_COUNTRY",O.FA_DOMAIN__INVALID_TEMPLATE="FA_DOMAIN__INVALID_TEMPLATE",(A=K||(K={}))[A.Nil=0]="Nil",A[A.Name=1]="Name",A[A.Logistics=2]="Logistics";let es={[E.FirstName]:K.Name,[E.LastName]:K.Name,[E.Name]:K.Name,[E.Country]:K.Logistics,[E.Province]:K.Logistics,[E.City]:K.Logistics,[E.District]:K.Logistics,[E.Postcode]:K.Logistics};function ec(e,t){return{get country(){return e},get template(){return t},takeGroupModel:()=>ep(function(e){let{props:t}=e,r=t.slice(0).sort((e,t)=>e.priority-t.priority),n=[];return r.reduce((e,t,i)=>{let o=e[e.length-1],a=i===r.length-1;return o?e.length<3&&es[o]&&es[o]===es[t.propKey]?(e.push(t.propKey),a&&n.push(e),e):(n.push(e),a&&n.push([t.propKey]),[t.propKey]):(a&&n.push([t.propKey]),[t.propKey])},[]),n}(t)),takeGroupModelWithStringifyTemplate:e=>ep(function*(e){let t=[],r={begin:-1,end:-1},n=(r,n)=>{let i=e.length-1;if(r<0||n<0||r>i||n>i||r>=n)return;let o=e.slice(r+1,n);o.length<=0||t.push(o)};for(let i=0;i<e.length;++i){let o=e[i];switch(o){case"{":r={begin:i,end:-1};break;case"}":r.end=i,n(r.begin,r.end);break;case"_":yield Array.from(t),t=[]}}t.length>0&&(yield Array.from(t))}(e))}}function ep(e){let t=[];for(let r of e)t.push({type:"Group",elements:r.map(e=>("address1"===e&&(e=E.Address),{type:"Element",fieldName:e}))});return{prependGroup(...e){let r=new Set(e);(t=eh(t,e=>!r.has(e))).unshift(ef(e))},insertGroupBefore(e,...r){let n=new Set(r);t=eh(t,e=>!n.has(e));let i=-1;t.forEach((t,r)=>{t&&"Group"===t.type&&t.elements.forEach(t=>{"Element"===t.type&&t.fieldName===e&&(i=r)})}),(i<0||i>=t.length)&&(i=t.length),t=[...t.slice(0,i),ef(r),...t.slice(i)]},build(){let e=[];return t.forEach(t=>{"Group"===t.type&&e.push(t.elements.map(e=>e.fieldName))}),e}}}function ef(e){return{type:"Group",elements:e.map(ey)}}function ey(e){return{type:"Element",fieldName:e}}function eh(e,t){let r=[];return e.forEach(e=>{if(e&&"Group"===e.type){let n=function(e,t){if(!e)return null;let r=[];return(e.elements.forEach(e=>{e&&t(e.fieldName)&&r.push(e)}),r.length<=0)?null:{type:"Group",elements:r}}(e,t);n&&r.push(n)}}),r}function em(e,t){return e.levelValueMap[t]}function ev(e,t){return e.infoFieldSet.has(t)?e.infoFieldValueMap[t]:void 0}function eb(e,t){switch(t){case E.FirstName:case E.LastName:return e.addressTemplateNameMode===D.FLName;case E.Name:return e.addressTemplateNameMode===D.NAME;default:return!0}}var eg={initDomainState:function(e){let t={addressTemplate:e.addressTemplate,addressTemplateNameMode:e.addressTemplate.nameType,fieldLayoutGroup:e.fieldLayoutGroup,fieldTemplateMap:{},levelValueMap:x.reduce((e,t)=>(e[t]={code:void 0,name:void 0},e),{}),levelAddressBookTraverserMap:x.reduce((e,t)=>(e[t]=ed(),e),{}),infoFieldSet:new Set,infoFieldValueMap:{}};return e.addressTemplate.props.forEach(e=>{V(e).with({propKey:U.union(...x)},e=>{t.fieldTemplateMap[e.propKey]=e}).otherwise(e=>{t.infoFieldSet.add(e.propKey),t.fieldTemplateMap[e.propKey]=e})}),t},withLevelField:function(e,t,r){let[n,i,o]=r([e.fieldTemplateMap[t],e.levelValueMap[t],e.levelAddressBookTraverserMap[t]]);if(e=Object.assign({},e),Q(n)&&o[t]){e.levelAddressBookTraverserMap=Object.assign(Object.assign({},e.levelAddressBookTraverserMap),o);let r=eu(o[t],[i.code,i.name]);r||(i=H())}else i=Y(n=X(n))?Object.assign(Object.assign({},H()),{name:i.name}):Object.assign({},H()),function(e,t){let r=!1;for(let n=0;n<x.length;++n)x[n]===t&&(r=!0),r&&e(x[n])}(t=>{var r;e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:X(null===(r=e.fieldTemplateMap)||void 0===r?void 0:r[t])})},t);return e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:n}),e.levelValueMap=Object.assign(Object.assign({},e.levelValueMap),{[t]:i}),e},withInfoField:function(e,t,r){let[n,i]=r([e.fieldTemplateMap[t]||J(t),e.infoFieldValueMap[t]]);return(e=Object.assign({},e)).infoFieldSet.has(t)||(e.infoFieldSet=new Set(e.infoFieldSet),e.infoFieldSet.add(t)),e.fieldTemplateMap=Object.assign(Object.assign({},e.fieldTemplateMap),{[t]:n}),e.infoFieldValueMap=Object.assign(Object.assign({},e.infoFieldValueMap),{[t]:Y(n)?i:null}),e},isNameModeMatched:eb,getLevelInfo:em,getCountryCode:function(e){return em(e,E.Country).code},getInfoFieldValue:ev,getAddressInfo:function(e){let t={};for(let r of e.infoFieldSet){let n=ev(e,r)||"";switch(r){case E.Name:eb(e,E.Name)&&(t[E.Name]=n);break;case E.LastName:case E.FirstName:eb(e,r)&&(t[r]=n);break;default:t[r]=n}}return Z().forEach(r=>{let n=em(e,r);t[R(r)]=n.code||"",t[r]=n.name||""}),t},getFieldTemplateLayout:function(e){let t=new Set,r={};for(let n of e.fieldLayoutGroup){let i=[];n.forEach(r=>{e.fieldTemplateMap[r]&&(eb(e,r)||r!==E.LastName||(r=E.Name),Y(e.fieldTemplateMap[r])&&eb(e,r)&&(t.has(r)&&t.delete(r),t.add(r),i.push(r)))}),r=Object.assign(Object.assign({},r),function(e){let t={},r=[],n=[];return(e||[]).forEach((e,t)=>{let i=Math.floor(t/3),o=Math.floor(t/3);null==r[i]?r[i]=1:r[i]+=1,null==n[o]?n[o]=1:n[o]+=1}),(e||[]).forEach((e,i)=>{null==t[e]&&(t[e]={xs:24,md:24/(r[Math.floor(i/3)]||1),xl:24/(n[Math.floor(i/3)]||1)})}),t}(i))}let n=[];return[...e.infoFieldSet,...Z()].forEach(e=>{t.has(e)||n.push(e)}),{get fieldTemplateLayout(){return r},get fieldTemplateSequence(){return[...t,...n.sort((t,r)=>e.fieldTemplateMap[t].priority-e.fieldTemplateMap[r].priority)]}}}};function ew(e){function t(t,r){return eo(this,void 0,void 0,function*(){let n,i,o=et(),a=yield e.getAddressTemplate(t||"DEFAULT");if(a.success&&(o=a.data),"function"==typeof(null==r?void 0:r.addressTemplateDecorator)){let e=er(o);r.addressTemplateDecorator(e),o=e.build()}return{addressTemplate:o,fieldLayoutGroup:(i=ec(t,o),"function"==typeof(null==r?void 0:r.fieldLayoutGroupDecorator)&&(n=r.fieldLayoutGroupDecorator(i)),n||(n=i.takeGroupModel()),n.build())}})}return{reduce(r,n,i){return eo(this,void 0,void 0,function*(){let o;if(i.isClean())return en(r);let a=yield e.getCountryList();if(!a.success||a.data.length<=0){let e=yield t("DEFAULT",n);o=eg.initDomainState({addressTemplate:e.addressTemplate,fieldLayoutGroup:e.fieldLayoutGroup}),o=eg.withLevelField(o,E.Country,([e])=>[e,H(),el([],E.Country,1)])}else{let e=el(a.data.map(e=>({name:e.name,code:e.code,alias:"",pCode:"",gCode:e.code,zipCode:[]})),E.Country,1),l=i.diffAddressFieldInfo(E.Country);if("Changed"===l.type){let r=V(l.payload).with({type:"fieldUpdatedBlob",payload:U.select()},e=>e.candidates[0]).with({type:"fieldsUpdatedBlob",payload:U.select()},e=>e[E.Country][0]).with({type:"addressInfoReplacedBlob",payload:U.select()},e=>e.countryCode||"").with({type:"addressInfoUpdatedBlob",payload:U.select()},e=>e.countryCode||"").otherwise(()=>""),i=r?a.data.find(e=>e.code===r):null;if(null==i){let r=yield t("DEFAULT",n);o=eg.initDomainState({addressTemplate:r.addressTemplate,fieldLayoutGroup:r.fieldLayoutGroup}),o=eg.withLevelField(o,E.Country,([t])=>[t,H(),e])}else{let r=yield t(i.code,n);o=eg.initDomainState({addressTemplate:r.addressTemplate,fieldLayoutGroup:r.fieldLayoutGroup}),o=eg.withLevelField(o,E.Country,([t])=>[t,i,e])}}else{let i=yield t(eg.getCountryCode(r),n);o=eg.initDomainState({addressTemplate:i.addressTemplate,fieldLayoutGroup:i.fieldLayoutGroup}),o=eg.withLevelField(o,E.Country,([t])=>[t,r.levelValueMap[E.Country],e])}}for(let t of Z(!0))o=yield function(t,r,n,i){return eo(this,void 0,void 0,function*(){let o=r.fieldTemplateMap[n],a=i.diffAddressFieldInfo(n);if(!Q(o))return eg.withLevelField(r,n,([e])=>[X(e),V(a).with({type:"Changed",payload:U.select()},e=>Object.assign(Object.assign({},H()),{name:ea(e,n)})).otherwise(()=>Q(t.fieldTemplateMap[n])?H():Object.assign(Object.assign({},t.levelValueMap[n]),{code:void 0})),{}]);if(!Y(o))return r;let l=function(e,t){let r=1,n=z(t);for(;null!=n;){let t=e.fieldTemplateMap[n];if(!Q(t))break;if(Y(t))return{fieldName:n,addressCode:e.levelValueMap[n].code||"",depth:r};r+=1,n=z(n)}return null}(r,n);if(null==l)return eg.withLevelField(r,n,([e])=>[X(e),V(a).with({type:"Changed",payload:U.select()},e=>Object.assign(Object.assign({},H()),{name:ea(e,n)})).otherwise(()=>Object.assign(Object.assign({},t.levelValueMap[n]),{code:void 0})),{}]);let d=eg.getCountryCode(r);if(!d||!l.addressCode)return eg.withLevelField(r,n,([e])=>[ee(e),H(),{[n]:ed()}]);let u=yield e.getAddressBook(d,l.fieldName,l.addressCode,l.depth);if(!u.success||u.data.length<=0)return eg.withLevelField(r,n,([e])=>[X(e),V(a).with({type:"Changed",payload:U.select()},e=>Object.assign(Object.assign({},H()),{name:ea(e,n)})).otherwise(()=>Object.assign(Object.assign({},t.levelValueMap[n]),{code:void 0})),{}]);let s=el(u.data,W(l.fieldName),l.depth);return eg.withLevelField(r,n,([e])=>[ee(e),V(a).with({type:"Changed",payload:U.select()},e=>{let t=eu(s[n],V(e).with({type:"fieldUpdatedBlob",payload:U.select()},e=>e.candidates).with({type:"fieldsUpdatedBlob",payload:U.select()},e=>e[n]||[]).with({type:U.union("addressInfoUpdatedBlob","addressInfoReplacedBlob"),payload:U.select()},e=>[q(n)&&e[R(n)]||"",e[n]||""]).otherwise(()=>[]));return t?{code:t.code,name:t.name}:H()}).otherwise(()=>{let e=eg.getLevelInfo(t,n),r=eu(s[n],[e.code,e.name]);return r?{code:r.code,name:r.name}:H()}),s])})}(r,o,t,i);for(let e of Z(!0).reverse())o=yield function(e,t,r,n){return eo(this,void 0,void 0,function*(){if(!function(e,t,r,n){let i=t.fieldTemplateMap[r];if(!Q(i)||Y(i))return!1;let o=W(r);if(!o)return!1;let a=t.fieldTemplateMap[o];return Q(a)&&!!eg.getLevelInfo(t,o).code}(0,t,r))return t;let e=W(r);if(!e)return t;let n=eg.getLevelInfo(t,e),i=eu(t.levelAddressBookTraverserMap[e],[n.code]);if(!i)return t;let o=i.parentCode||i.pCode||i.pcode;if(!o)return t;let a=eu(t.levelAddressBookTraverserMap[r],[o]);return a?eg.withLevelField(t,r,([e,t,n])=>[e,{code:a.code,name:a.name},{[r]:n}]):t})}(0,o,e);for(let e of o.infoFieldSet)o=yield function(e,t,r,n,i){return eo(this,void 0,void 0,function*(){let o=n.diffAddressFieldInfo(r);return eg.withInfoField(t,r,([t,n])=>{if("function"==typeof(null==i?void 0:i.fieldTemplateDecorator)){let e=i.fieldTemplateDecorator(r,t);null!=e&&(t=Object.assign(Object.assign({},t),{display:e.display}))}return[t,V(o).with({type:"Changed",payload:U.select()},e=>ea(e,r)).otherwise(()=>eg.getInfoFieldValue(e,r))]})})}(r,o,e,i,n);return en(o=yield function(e,t,r){return eo(this,void 0,void 0,function*(){if(!function(e,t){if(eg.getInfoFieldValue(e,E.Postcode))return!1;let r=t.diffAddressFieldInfo(E.Postcode);return V(r).with({type:"Changed",payload:U.select()},e=>V(e).with({type:U.union("fieldUpdatedBlob","fieldsUpdatedBlob")},e=>!1).otherwise(()=>!0)).otherwise(()=>!0)}(t,r))return t;let e=E.District;do{if(null!=e&&Q(t.fieldTemplateMap[e])){let r=eu(t.levelAddressBookTraverserMap[e],[eg.getLevelInfo(t,e).code]);if(r){"string"==typeof r.zipCode&&r.zipCode?t.infoFieldValueMap[E.Postcode]=r.zipCode:Array.isArray(r.zipCode)&&r.zipCode[0]&&(t.infoFieldValueMap[E.Postcode]=r.zipCode[0]);break}}e=z(e)}while(e);return t})}(0,o,i))})}}}function eT(e,t){let r=eg.getFieldTemplateLayout(e),n={get addressInfo(){return eg.getAddressInfo(e)},get addressTemplate(){return e.addressTemplate},get fieldTemplateMap(){return Object.assign({},e.fieldTemplateMap)},get fieldAddressBookTraverser(){return Object.assign({},e.levelAddressBookTraverserMap)},fieldTemplateLayout:r.fieldTemplateLayout,fieldTemplateSequence:r.fieldTemplateSequence,get fieldAddressBookMap(){return Z().reduce((t,r)=>{let n=e.levelAddressBookTraverserMap[r];return Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get(){let e=[];return n&&n.traverse((t,r)=>{let n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}(r,["subNodes"]);e.push(n)}),e}}),t},{})},traverseAddressLevelField(t){Z().forEach(r=>t(r,e.fieldTemplateMap[r]))},traverseAddressInfoField(t){e.infoFieldSet.forEach(r=>t(r,e.fieldTemplateMap[r]))},traverseAddressField(e){n.traverseAddressLevelField(e),n.traverseAddressInfoField(e)},bailTraverseAddressLevelField(t,r){let n=Z();for(let r=0;r<n.length;++r){let i=n[r],o=t(i,e.fieldTemplateMap[i]);if(void 0!==o)return o}return r}};return n}function eO(e){let t,r;return function(...n){if(t&&function e(t,r){if(t===r)return!0;if(null==t||null==r)return!1;let n=typeof t,i=typeof r;if(n!==i||"function"===n)return!1;if(Array.isArray(t)&&Array.isArray(r)){let n=t.length,i=r.length;if(n!==i)return!1;let o=0;for(;o<n;++o){let n=t[o],i=r[o];if(!e(n,i))return!1}return o===i}return!1}(t,n)&&r)return r;t=n,r=void 0;let i=e.apply(this,n);return r=i,i&&"object"==typeof i&&(i instanceof Promise||"function"==typeof i.then)&&i&&"object"==typeof i&&(i instanceof Promise||"function"==typeof i.catch)&&i.catch(e=>{t===n&&r===i&&(t=void 0,r=void 0)}),i}}function eA(e){let t=function(e){return{getAddressTemplate:eO(t=>eo(this,void 0,void 0,function*(){let r=yield e.getAddressTemplate(t).catch(e=>(console.error("failed to get getAddressTemplate",e),ei("FA_ADDRESS_UNKNOWN")));return r.success?Object.assign(Object.assign({},r),{data:Object.assign(Object.assign({},r.data),{props:r.data.props.map(e=>"address1"===e.propKey?Object.assign(Object.assign({},e),{propKey:E.Address}):e)})}):r}))}}(e.addressTemplateFetcher),r=function(e){let t={};return{getAddressBook(r,n,i,o){let a=function(r,n,i,o){let a=`${r}__${n}__${o||1}`;return null==t[a]&&(t[a]={getAddressBook:eO((t,r,n,i)=>e.getAddressBook(t,r,n,i).catch(e=>(console.error("failed to get getAddressBook",e),ei("FA_ADDRESS_UNKNOWN"))))}),t[a]}(r,n,0,o);return a.getAddressBook(r,n,i,o)}}}(e.addressBookFetcher),n=function(e){let t=eO(e.getCountryList);return{getCountryList:()=>t().catch(e=>(console.error("failed to get getCountryList",e),ei("FA_ADDRESS_UNKNOWN")))}}(e.countrySource);return{get port(){return Object.assign(Object.assign(Object.assign({},n),t),r)}}}let eC="Defer",eM="Blocking";var eN="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},eF={},eL={},ej={},eS=eN&&eN.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{d(n.next(e))}catch(e){o(e)}}function l(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,l)}d((n=n.apply(e,t||[])).next())})},eI=eN&&eN.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}};Object.defineProperty(ej,"__esModule",{value:!0});var e_=new Promise(function(e){});ej.default={zombie:e_,resolvable:function(){var e,t=!1;return[new Promise(function(r){t?r():e=r}),function(){t=!0,"function"==typeof e&&e()}]},resolveAfterEventBubbled:function(e,t){return eS(this,void 0,void 0,function(){return eI(this,function(r){return[2,new Promise(function(r){var n=function(i){e.removeEventListener(t,n),r(i)};e.addEventListener(t,n)})]})})},resolveAfterSeconds:function(e){return eS(this,void 0,void 0,function(){return eI(this,function(t){return e<=0?[2,Promise.resolve()]:[2,new Promise(function(t){setTimeout(function(){t()},1e3*e)})]})})},resolveAfterDuration:function(e){return eS(this,void 0,void 0,function(){return eI(this,function(t){return e<=0?[2,Promise.resolve()]:[2,new Promise(function(t){setTimeout(function(){t()},e)})]})})}};var eP={};Object.defineProperty(eP,"__esModule",{value:!0});var eE=function(){function e(e){this.v=e}return Object.defineProperty(e.prototype,"timestamp",{get:function(){return this.v},enumerable:!1,configurable:!0}),e.prototype.add=function(t){return new e(this.v+t)},e.prototype.sub=function(t){return new e(this.v-t)},e.prototype.duration=function(e){return this.v-e.timestamp},e}();function eD(e){return new eE(e)}function ek(){return eD(Date.now())}eP.default={time:eD,now:ek,later:function(e){return ek().add(e)},former:function(e){return ek().sub(e)},Millisecond:1,Second:1e3,Minute:6e4,Hour:36e5,Day:864e5,Week:6048e5};var eB={};Object.defineProperty(eB,"__esModule",{value:!0}),eB.default={errCanceled:"context done with cancellation",errTimeout:"context done with timeout",errDeadline:"context done with deadline",errNotNullableValuer:"valuer is not nullable"};var eK=eN&&eN.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(eL,"__esModule",{value:!0});var eU=eK(ej),eV=eK(eP),eG=eK(eB);function ex(){return{deadline:function(){return null},done:function(){return eU.default.zombie},err:function(){return null},value:function(e){return e?e.defaultGetter():null}}}function eq(e){return e||(e=ez),{deadline:function(){return e.deadline()},done:function(){return e.done()},err:function(){return e.err()},value:function(t){return e.value(t)}}}function eR(e){var t=eU.default.resolvable(),r=t[0],n=t[1],i=null;return[{deadline:function(){return e.deadline()},done:function(){return Promise.race([e.done().then(function(){return e.err()}),r.then(function(){return Error(eG.default.errCanceled)})]).then(function(e){i=e})},err:function(){return i},value:function(t){return e.value(t)}},n]}eL.default={background:function(){return eq(ez)},todo:function(){return eq(eW)},withValue:function(e,t,r){return{deadline:function(){return e.deadline()},done:function(){return e.done()},err:function(){return e.err()},value:function(n){return t===n?r:e.value(n)}}},withCancel:function(e){return eR(e)},withTimeout:function(e,t){var r,n,i;return eR((n=eV.default.later(t),i=eU.default.resolveAfterDuration(t),{deadline:function(){return n},done:function(){return Promise.race([e.done().then(function(){return e.err()}),i.then(function(){return Error(eG.default.errTimeout)})]).then(function(e){r=e})},err:function(){return r},value:function(t){return e.value(t)}}))},withDeadline:function(e,t){var r,n;return eR((r=null,n=eU.default.resolveAfterDuration(t.duration(eV.default.now())),{deadline:function(){return t},done:function(){return Promise.race([e.done().then(function(){return e.err()}),n.then(function(){return Error(eG.default.errDeadline)})]).then(function(e){r=e})},err:function(){return r},value:function(t){return e.value(t)}}))}};var ez=ex(),eW=ex(),e$={},eZ=eN&&eN.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e$,"__esModule",{value:!0});var eH=eZ(eB);function eJ(e){return Object.defineProperty({},"defaultGetter",{value:e,writable:!1,configurable:!1})}e$.default={newValuer:function(e){return eJ(void 0===e?function(){throw Error(eH.default.errNotNullableValuer)}:function(){return e})},newValuerWithGetter:function(e){return"function"!=typeof e&&(e=function(){throw Error(eH.default.errNotNullableValuer)}),eJ(e)}},C=eN&&eN.__assign||function(){return(C=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},M=eN&&eN.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),N=eN&&eN.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||M(t,e,r)},F=eN&&eN.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},Object.defineProperty(eF,"__esModule",{value:!0}),L=F(eL),j=F(eB),S=F(e$),N(eL,eF),N(e$,eF),eF.default=C(C(C({},j.default),L.default),S.default);var eY=eF&&eF.__esModule&&Object.prototype.hasOwnProperty.call(eF,"default")?eF.default:eF;window["@sl/address-component"]={createHost:function(e){var t,r,n;let i;let o=er((null===(t=null==e?void 0:e.initState)||void 0===t?void 0:t.addressTemplate)||et());"function"==typeof(null===(r=null==e?void 0:e.initProps)||void 0===r?void 0:r.addressTemplateDecorator)&&e.initProps.addressTemplateDecorator(o);let a=o.build(),l=ec(a.country,a);"function"==typeof(null===(n=null==e?void 0:e.initProps)||void 0===n?void 0:n.fieldLayoutGroupDecorator)&&(i=null==e?void 0:e.initProps.fieldLayoutGroupDecorator(l)),null==i&&(i=l.takeGroupModel());let d=eg.initDomainState({addressTemplate:a,fieldLayoutGroup:i.build()}),u=e.initProps||{},s=eT(d),c=eA(e.adapter),p=function(){let e=new Set;return{next(t){e.forEach(e=>{"function"==typeof e&&e(t)})},subscribe:t=>(e.add(t),{unsubscribe(){e.delete(t)}})}}(),f=ew(c.port),y=function(e){let t=[],r=[],n=function(e,t){var r;let n={pending:!1,scheduled:!1},i=(r=()=>{n.pending=!1,o()},{tick(e){e().finally(()=>{r()})}}),o=()=>{!n.pending&&n.scheduled&&(n.scheduled=!1,n.pending=!0,i.tick(e))};return{tick(e){switch(e){case eC:var r;n.scheduled=!0,setTimeout(()=>{o()},("number"!=typeof(r=null==t?void 0:t.deferTimeout)&&(r=Number(r)),(r!=r||r<0)&&(r=10),r));return;case eM:n.scheduled=!0,o();return;default:return}}}}(()=>eo(this,void 0,void 0,function*(){let n=t.slice(0);for(;n.length>0;)yield e(n),t.splice(0,n.length),n=t.slice(0);r.splice(0).forEach(e=>{"function"==typeof e&&e()})}),{deferTimeout:10});return{add(e){console.debug("add address blob stream",JSON.stringify(e,null,2)),t.push(e),V(V(e).with({type:U.union("addressInfoReplacedBlob","addressInfoUpdatedBlob","fieldsUpdatedBlob")},e=>eM).with({type:"fieldUpdatedBlob",payload:U.select()},e=>Reflect.has(e,E.Country)?eM:eC).otherwise(()=>eC)).with(eM,()=>n.tick(eM)).otherwise(()=>n.tick(eC))},exhaust:()=>t.length<=0?Promise.resolve():new Promise(e=>{r.push(e)})}}(e=>eo(this,void 0,void 0,function*(){let t=function(e){var t;let r=(t=e.reverse(),function(e){for(let r of t){let t=e(r);if(void 0!==t)return t}});function n(e){return void 0!==e?{type:"Changed",payload:e}:{type:"Clean"}}return{isClean:()=>e.length<=0,diffDomainProps:()=>n(r(e=>V(e).with({type:"domainPropsUpdatedBlob"},e=>e).otherwise(()=>void 0))),diffAddressFieldInfo:e=>n(r(t=>V(t).with({type:"fieldUpdatedBlob",payload:{fieldName:e}},e=>e).with({type:"fieldsUpdatedBlob"},({payload:t})=>null!=t[e],e=>e).with({type:"addressInfoUpdatedBlob"},({payload:t})=>q(e)&&null!=t[R(e)]||null!=t[e],e=>e).with({type:"addressInfoReplacedBlob"},e=>e).otherwise(()=>void 0)))}}(e),r=u,n=t.diffDomainProps();"Changed"===n.type&&(r=n.payload.payload);let i=yield f.reduce(d,r,t);i.success?(d=i.data,s=eT(i.data),p.next(s),u=r):p.next(s)})),h={init(){var t;return y.add({type:"addressInfoReplacedBlob",payload:(null===(t=e.initState)||void 0===t?void 0:t.addressInfo)||{}}),h.exhaustModel()},getModel:()=>s,exhaustModel:()=>y.exhaust().then(()=>s),observeModel:(e,t)=>(!0===t&&setTimeout(()=>{e(s)},0),p.subscribe(e)),updateAdapter(e){h.exhaustModel().finally(()=>{f=ew((c=eA(e)).port),h.updateFieldsValue({})})},updateProps(e){let t;t="function"==typeof e?e(u):e,y.add({type:"domainPropsUpdatedBlob",payload:t})},updateFieldValue(e,...t){y.add({type:"fieldUpdatedBlob",payload:{fieldName:e,candidates:t}})},updateFieldsValue(e){y.add({type:"fieldsUpdatedBlob",payload:Object.keys(e).reduce((t,r)=>(t[r]=[e[r]],t),{})})},updateFieldsValueWithCandidates(e){y.add({type:"fieldsUpdatedBlob",payload:Object.keys(e).reduce((t,r)=>(t[r]=e[r],t),{})})},updateAddressInfo(e){y.add({type:"addressInfoUpdatedBlob",payload:e})},clearAddressInfo(){y.add({type:"addressInfoReplacedBlob",payload:{}})},replaceAddressInfo(e){y.add({type:"addressInfoReplacedBlob",payload:e})}};return h},distinctUntil:function(e,t,r,n){var i;let o,[a,l]=eY.withCancel(eY.background()),[d,u]=eY.withCancel(a),s=(i=([e,n])=>{if("function"==typeof t&&t(e,n)){let[e,t]=eY.withCancel(a);u(),d.done().finally(()=>{r(e,n)}),d=e,u=t}},e.observeModel(e=>{let t=(null==o?void 0:o.addressInfo)||{},r=e.addressInfo,n=new Set(Object.keys(t)),a=new Set(Object.keys(r)),l={};a.forEach(e=>{n.has(e)&&t[e]===r[e]||(l[e]=r[e]||null),n.delete(e)}),n.forEach(e=>{l[e]=null}),i([o,e,l]),o=e},n));return a.done().finally(()=>{s.unsubscribe()}),{unsubscribe(){l()}}},"/domain-model":{FieldNameEnum:E,FieldInteractionEnum:k}}}();
