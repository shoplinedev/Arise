"use strict";

(self["webpackChunkArise"] = self["webpackChunkArise"] || []).push([ [ "recently-viewed" ], {
    "./src/assets/product/recently-viewed/index.js": (__unused_webpack_module, __unused_webpack___webpack_exports__, __webpack_require__) => {
        __webpack_require__("./node_modules/core-js/modules/es.object.define-property.js");
        __webpack_require__("../shared/node_modules/regenerator-runtime/runtime.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.object.to-string.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.promise.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.array.filter.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.regexp.exec.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.string.split.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.array.index-of.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.array.join.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.array.map.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.array.find.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.object.define-property.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.object.keys.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.symbol.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.object.get-own-property-descriptor.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.array.for-each.js");
        __webpack_require__("../shared/node_modules/core-js/modules/web.dom-collections.for-each.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.object.get-own-property-descriptors.js");
        __webpack_require__("../shared/node_modules/core-js/modules/es.object.define-properties.js");
        var axios = __webpack_require__("../shared/node_modules/axios/index.js");
        var axios_default = __webpack_require__.n(axios);
        var query_string = __webpack_require__("../shared/node_modules/query-string/index.js");
        function ownKeys(object, enumerableOnly) {
            var keys = Object.keys(object);
            if (Object.getOwnPropertySymbols) {
                var symbols = Object.getOwnPropertySymbols(object);
                if (enumerableOnly) symbols = symbols.filter((function(sym) {
                    return Object.getOwnPropertyDescriptor(object, sym).enumerable;
                }));
                keys.push.apply(keys, symbols);
            }
            return keys;
        }
        function _objectSpread(target) {
            for (var i = 1; i < arguments.length; i++) {
                var source = null != arguments[i] ? arguments[i] : {};
                if (i % 2) ownKeys(Object(source), true).forEach((function(key) {
                    _defineProperty(target, key, source[key]);
                })); else if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); else ownKeys(Object(source)).forEach((function(key) {
                    Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
                }));
            }
            return target;
        }
        function _defineProperty(obj, key, value) {
            if (key in obj) Object.defineProperty(obj, key, {
                value,
                enumerable: true,
                configurable: true,
                writable: true
            }); else obj[key] = value;
            return obj;
        }
        function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
            try {
                var info = gen[key](arg);
                var value = info.value;
            } catch (error) {
                reject(error);
                return;
            }
            if (info.done) resolve(value); else Promise.resolve(value).then(_next, _throw);
        }
        function _asyncToGenerator(fn) {
            return function() {
                var self = this, args = arguments;
                return new Promise((function(resolve, reject) {
                    var gen = fn.apply(self, args);
                    function _next(value) {
                        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
                    }
                    function _throw(err) {
                        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
                    }
                    _next(void 0);
                }));
            };
        }
        var http = axios_default().create({
            baseURL: "/leproxy",
            timeout: 3e4,
            withCredentials: true,
            paramsSerializer: function(params) {
                return query_string.stringify(params);
            }
        });
        function getProductsInfo(_x, _x2) {
            return _getProductsInfo.apply(this, arguments);
        }
        function _getProductsInfo() {
            _getProductsInfo = _asyncToGenerator(regeneratorRuntime.mark((function _callee(excludeProductIds, productIds) {
                var recentlyProductIds, realRecentlyProductIds, _yield$http$get, data, sortProductInfoVoList;
                return regeneratorRuntime.wrap((function(_context) {
                    while (1) switch (_context.prev = _context.next) {
                      case 0:
                        recentlyProductIds = null !== productIds && void 0 !== productIds ? productIds : window.localStorage.getItem("history_browse_products");
                        realRecentlyProductIds = null === recentlyProductIds || void 0 === recentlyProductIds ? void 0 : recentlyProductIds.split(",").filter((function(item) {
                            if ((null === excludeProductIds || void 0 === excludeProductIds ? void 0 : excludeProductIds.length) > 0) return -1 === excludeProductIds.indexOf(item);
                            return item;
                        }));
                        if (null !== realRecentlyProductIds && void 0 !== realRecentlyProductIds && realRecentlyProductIds.join(",")) {
                            _context.next = 4;
                            break;
                        }
                        return _context.abrupt("return", []);

                      case 4:
                        _context.next = 6;
                        return http.get("/api/product/detail/info/batch/query", {
                            params: {
                                productIdStr: realRecentlyProductIds.join(",")
                            }
                        });

                      case 6:
                        _yield$http$get = _context.sent;
                        data = _yield$http$get.data.data;
                        sortProductInfoVoList = recentlyProductIds.split(",").map((function(item) {
                            var hitProduct = null === data || void 0 === data ? void 0 : data.productInfoVoList.find((function(_item) {
                                return _item.spuSeq === item;
                            }));
                            if (hitProduct) return hitProduct;
                            return null;
                        }));
                        return _context.abrupt("return", sortProductInfoVoList.filter((function(item) {
                            return !!item;
                        })));

                      case 10:
                      case "end":
                        return _context.stop();
                    }
                }), _callee);
            })));
            return _getProductsInfo.apply(this, arguments);
        }
        function fetchRecentlySection(_x3) {
            return _fetchRecentlySection.apply(this, arguments);
        }
        function _fetchRecentlySection() {
            _fetchRecentlySection = _asyncToGenerator(regeneratorRuntime.mark((function _callee2(_ref) {
                var _ref$sectionName, sectionName, excludeProductIds, productIds, context, _ref$mode, mode, productInfoVoList, query, queryPath, _Window, _Window$SL_State, _Window$SL_State$get, _yield$http$post, data, html;
                return regeneratorRuntime.wrap((function(_context2) {
                    while (1) switch (_context2.prev = _context2.next) {
                      case 0:
                        _ref$sectionName = _ref.sectionName, sectionName = void 0 === _ref$sectionName ? "product/detail/recently-viewed-products" : _ref$sectionName, 
                        excludeProductIds = _ref.excludeProductIds, productIds = _ref.productIds, context = _ref.context, 
                        _ref$mode = _ref.mode, mode = void 0 === _ref$mode ? "" : _ref$mode;
                        _context2.next = 3;
                        return getProductsInfo(excludeProductIds, productIds);

                      case 3:
                        productInfoVoList = _context2.sent;
                        query = {
                            sectionId: sectionName,
                            context: _objectSpread({
                                historyBrowseProducts: productInfoVoList
                            }, context)
                        };
                        queryPath = "/page/section";
                        if ("SINGLE" === mode) {
                            query = {
                                data: query
                            };
                            query.mode = mode;
                            queryPath = "/page".concat((null === (_Window = Window) || void 0 === _Window ? void 0 : null === (_Window$SL_State = _Window.SL_State) || void 0 === _Window$SL_State ? void 0 : null === (_Window$SL_State$get = _Window$SL_State.get) || void 0 === _Window$SL_State$get ? void 0 : _Window$SL_State$get.call(_Window$SL_State, "request.uri.path")) || window.location.pathname);
                        }
                        _context2.next = 9;
                        return http.post(queryPath, query);

                      case 9:
                        _yield$http$post = _context2.sent;
                        data = _yield$http$post.data;
                        html = "SINGLE" === mode ? null === data || void 0 === data ? void 0 : data.html : data;
                        return _context2.abrupt("return", null !== html && void 0 !== html ? html : "");

                      case 13:
                      case "end":
                        return _context2.stop();
                    }
                }), _callee2);
            })));
            return _fetchRecentlySection.apply(this, arguments);
        }
        function initProductRecentlyList(_x4) {
            return _initProductRecentlyList.apply(this, arguments);
        }
        function _initProductRecentlyList() {
            _initProductRecentlyList = _asyncToGenerator(regeneratorRuntime.mark((function _callee3(_ref2) {
                var selector, sectionName, excludeProductIds, productIds, context, mode, data, mountDom, _window, _window$lozadObserver;
                return regeneratorRuntime.wrap((function(_context3) {
                    while (1) switch (_context3.prev = _context3.next) {
                      case 0:
                        selector = _ref2.selector, sectionName = _ref2.sectionName, excludeProductIds = _ref2.excludeProductIds, 
                        productIds = _ref2.productIds, context = _ref2.context, mode = _ref2.mode;
                        _context3.next = 3;
                        return fetchRecentlySection({
                            sectionName,
                            excludeProductIds,
                            productIds,
                            context,
                            mode
                        });

                      case 3:
                        data = _context3.sent;
                        mountDom = document.querySelector(selector);
                        if (mountDom) {
                            mountDom.innerHTML = data;
                            null === (_window = window) || void 0 === _window ? void 0 : null === (_window$lozadObserver = _window.lozadObserver) || void 0 === _window$lozadObserver ? void 0 : _window$lozadObserver.observe();
                        } else console.error("请添加有效的最近浏览商品模块挂载点");
                        return _context3.abrupt("return", data);

                      case 7:
                      case "end":
                        return _context3.stop();
                    }
                }), _callee3);
            })));
            return _initProductRecentlyList.apply(this, arguments);
        }
        var sectionsLoad = __webpack_require__("../shared/browser/utils/sectionsLoad/index.js");
        function _classCallCheck(instance, Constructor) {
            if (!(instance instanceof Constructor)) throw new TypeError("Cannot call a class as a function");
        }
        function _defineProperties(target, props) {
            for (var i = 0; i < props.length; i++) {
                var descriptor = props[i];
                descriptor.enumerable = descriptor.enumerable || false;
                descriptor.configurable = true;
                if ("value" in descriptor) descriptor.writable = true;
                Object.defineProperty(target, descriptor.key, descriptor);
            }
        }
        function _createClass(Constructor, protoProps, staticProps) {
            if (protoProps) _defineProperties(Constructor.prototype, protoProps);
            if (staticProps) _defineProperties(Constructor, staticProps);
            return Constructor;
        }
        function recently_viewed_defineProperty(obj, key, value) {
            if (key in obj) Object.defineProperty(obj, key, {
                value,
                enumerable: true,
                configurable: true,
                writable: true
            }); else obj[key] = value;
            return obj;
        }
        var ProductPreviewSection = function() {
            function ProductPreviewSection() {
                var _window$SL_State$get;
                _classCallCheck(this, ProductPreviewSection);
                recently_viewed_defineProperty(this, "instance", null);
                initProductRecentlyList({
                    selector: "#recently-viewed-products",
                    excludeProductIds: [ null === (_window$SL_State$get = window.SL_State.get("product.spu")) || void 0 === _window$SL_State$get ? void 0 : _window$SL_State$get.spuSeq ],
                    context: {
                        hiddenMount: true
                    },
                    sectionName: "recently-viewed",
                    mode: "SINGLE"
                });
            }
            _createClass(ProductPreviewSection, [ {
                key: "onUnload",
                value: function() {
                    if (this.instance) ;
                }
            } ]);
            return ProductPreviewSection;
        }();
        recently_viewed_defineProperty(ProductPreviewSection, "type", "recently-viewed");
        (0, sectionsLoad.registrySectionConstructor)("recently-viewed", ProductPreviewSection);
    }
}, __webpack_require__ => {
    var __webpack_exec__ = moduleId => __webpack_require__(__webpack_require__.s = moduleId);
    __webpack_exec__("./src/assets/product/recently-viewed/index.js");
} ]);