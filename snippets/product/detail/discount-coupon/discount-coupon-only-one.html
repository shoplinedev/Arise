{{!-- 只有一个折扣券时，直接展示到前台 --}}

{{!-- couponTemplate '2'为自定义，'1'为提供的模板 --}}
{{assign 'couponTemplate' salesEnvCustomInfo.productDetailConfig.couponTemplate}}

{{!-- templateType:'template1'|'template2'|'customTemplate'，默认就是template1 --}}
{{assign 'templateType' 'template1'}}
{{#if couponTemplate '===' '2'}}
  {{assign 'templateType' 'customTemplate'}}
{{else if discountCodeDisplayStyle '===' "discountCodeStyle1"}}
  {{assign 'templateType' 'template1'}}
{{else if discountCodeDisplayStyle '===' "discountCodeStyle2"}}
  {{assign 'templateType' 'template2'}}
{{/if}}

{{ assign 'productDetailConfig' salesEnvCustomInfo.productDetailConfig}}

{{#if productDetailConfig.discountCodeBgColor}}
  {{assign 'containerStyle' (append 'background-color:' productDetailConfig.discountCodeBgColor ';')}}
{{else}}
  {{assign 'containerStyle' ''}}
{{/if}}

{{assign 'textColorStyle' ''}}
{{#if productDetailConfig.textColor}}
  {{assign 'textColorStyle' (append 'color:' productDetailConfig.textColor ';')}}
{{/if}}

{{assign 'textColorOpStyle' ''}}
{{#if productDetailConfig.textColor}}
  {{assign 'textColorOpStyle' (append 'color:' (rgba productDetailConfig.textColor 0.7) ';')}}
{{/if}}

{{assign 'discountCodeTextStyle' ''}}
{{#if productDetailConfig.discountCodeTextColor}}
  {{assign 'discountCodeTextStyle' (append 'color:' productDetailConfig.discountCodeTextColor ';')}}
{{/if}}

{{ assign 'currentActivityInfoItem' (itemAt activityCustomInfo 0)}}

{{!-- 按钮样式需要区分是否应用，所以使用style --}}
<style>
.sales__discountCouponOnlyOne-container.customTemplate .sales__discountCouponOnlyOne-applyBtn {
  {{#if productDetailConfig.btnBgColor}}
    background-color: {{productDetailConfig.btnBgColor}};
  {{/if}}
  {{#if productDetailConfig.btnTextColor}}
    color: {{productDetailConfig.btnTextColor}};
  {{/if}}
}
.sales__discountCouponOnlyOne-container.sales-discount-coupon--apply.customTemplate .sales__discountCouponOnlyOne-applyBtn {
  {{#if productDetailConfig.btnBgColor}}
    color:productDetailConfig.btnBgColor;
    background:transparent;
    border:1px solid {{productDetailConfig.btnBgColor}};
  {{/if}}
}
.sales__discountCouponOnlyOne-container.customTemplate .sales__discountCouponOnlyOne-left {
  {{#if productDetailConfig.btnBgColor}}
    border-right-color: {{rgba productDetailConfig.btnBgColor 0.7}}!important;
  {{/if}}
}
</style>
<div class="sales__discountCouponOnlyOne-container sales__discountCouponOnlyOne-container-hook {{templateType}}" style="{{containerStyle}}" data-discount-code="{{discountCode}}">
  {{ snippet 'sales/card-background' mobileBgImg=productDetailConfig.discountBgImg_mobile pcBgImg=productDetailConfig.discountBgImg}}
  <div class="sales__discountCouponOnlyOne-left">
    <div class="sales__discountCouponOnlyOne-leftTop">
      {{#if __customThresholdText}}
        <span class="sales__discountCouponOnlyOne-threshold" style="{{textColorStyle}}">{{noTranslationHTML __customThresholdText}}</span>
      {{/if}}
      {{#if __customDiscountText}}
        <span class="sales__discountCouponOnlyOne-discount" style="{{textColorStyle}}">{{noTranslationHTML __customDiscountText}}</span>
      {{/if}}
    </div>
    <div class="sales__discountCouponOnlyOne-leftBottom">
      {{!-- 过期时间 --}}
      {{#if endTime}}
        <span class="sales__discountCouponOnlyOne-otherInfoItem"
          style="{{textColorOpStyle}}">{{t 'sales.discount_coupon.active_date_until' endTime=(dayjs method='format' init=endTime format='MMM D,YYYY') }}</span>
      {{/if}}
      {{!-- 特定客户 --}}
      {{#if targetUserType}}
        {{#if (or (compare targetUserType '==' 6) (compare targetUserType '==' 5))}}
          <span class="sales__discountCouponOnlyOne-otherInfoItem" style="{{textColorOpStyle}}">{{t 'sales.discount_coupon.specified_customer'}}</span>
        {{else if targetUserType '==' 2}}
          <span class="sales__discountCouponOnlyOne-otherInfoItem"
            style="{{textColorOpStyle}}">{{t 'sales.discount_coupon.coupon_content_level' level=currentActivityInfoItem.level}}</span>
        {{/if}}
      {{/if}}
    </div>
    {{!-- 移动端-应用时显示 --}}
    <div class="notranslate sales__discountCouponOnlyOne-discountCode sales__discountCouponOnlyOne-discountCode-hook" style="{{discountCodeTextStyle}}">{{discountCode}}</div>
  </div>
  <div class="sales__discountCouponOnlyOne-right">
    <div class="sales__discountCouponOnlyOne-applyBtn sales__discountCouponOnlyOne-applyBtn-hook" data-discount-code="{{discountCode}}"
      data-apply="{{t 'sales.discount_coupon.apply'}}" data-applied="{{t 'sales.discount_coupon.applied'}}">{{t 'sales.discount_coupon.apply'}}</div>
    {{!-- PC端-应用时显示 --}}
    <div class="notranslate sales__discountCouponOnlyOne-discountCode sales__discountCouponOnlyOne-discountCode-hook" style="{{discountCodeTextStyle}}">{{discountCode}}</div>
  </div>
</div>